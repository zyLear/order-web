<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>

    <meta charset="UTF-8">
    <title>Title</title>


    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
    <title>测试</title>
    <!-- 引入样式文件 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>
<body>

<div id="app">
    <div style="margin: 20px;">
        <div>
            <h2>订单列表</h2>
        </div>

        <el-form :inline="true" class="demo-form-inline">
            <el-form-item label="手机号码">
                <el-input v-model="keyword" placeholder="手机号码"  @input="getOrderList()" clearable></el-input>
            </el-form-item>
            <el-form-item label="订单状态">
                <el-select v-model="orderStatus" @change="getOrderList()" placeholder="请选择订单状态">
                    <el-option
                            v-for="item in orderStatusList"
                            :key="item.value"
                            :label="item.label"
                            :value="item.value">
                    </el-option>
                </el-select>
            </el-form-item>
            <el-form-item>
                <el-button  type="success" @click="toCreateOrder()">创建订单</el-button>
            </el-form-item>
        </el-form>

        <el-table :data="tableData" border stripe style="width: 100%">
            <el-table-column prop="phoneNumber" label="手机号码" ></el-table-column>
            <el-table-column prop="remark" label="备注" ></el-table-column>
            <el-table-column prop="createTime" label="创建时间" width="170px"></el-table-column>
            <el-table-column prop="orderStatus" label="订单状态" width="90px">
                <template slot-scope="scope">
                    <el-tag :type="scope.row.orderStatus == 1 ? 'primary' : 'success'" disable-transitions>
                                                {{scope.row.orderStatus==1 ?'未完成':'已完成'}}

                    </el-tag>
                </template>
            </el-table-column>
            <el-table-column label="操作" width="90px">
                <template slot-scope="scope">
                    <el-button size="mini" v-bind:disabled="scope.row.orderStatus !=1" type="primary" @click="completeOrder(scope.row.id)">完成</el-button>

                </template>
            </el-table-column>
        </el-table>
    </div>


</div>


<!-- 引入 Vue 和 Vant 的 JS 文件 -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
<!-- 引入 -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<!-- axios 请求 -->
<script type="text/javascript" src="https://cdn.bootcss.com/axios/0.19.0-beta.1/axios.js"></script>
<script>

    var vue = new Vue({
        el: '#app',
        data: {
            message: "Hello Element Plus",
            orderStatus: 1,
            keyword: "",
            tableData: [],
            orderStatusList: [{
                value: 1,
                label: '未完成'
            }, {
                value: 2,
                label: '已完成'
            }]
        },
        methods: {
            getOrderList() {
                var api = "http://localhost/app-order/api/order/list?orderStatus=" + this.orderStatus + "&keyword=" + this.keyword;
                axios
                    // 3.1url地址
                    .get(api)
                    // 3.2成功时回调函数
                    .then((response) => {
                        console.log(response);
                        if (response.data.code === 0) {
                            vue.tableData = response.data.data;
                        } else {
                            alert(response.data.message);
                        }
                    })
                    //3.3失败时回调函数
                    .catch((err) => {
                        console.log(err);
                    });
            },
            completeOrder(id) {
                var api = "http://localhost/app-order/api/order/complete-order";
                axios
                    // 3.1url地址
                    .post(api, {"id": id})
                    // 3.2成功时回调函数
                    .then((response) => {
                        console.log(response);
                        if (response.data.code === 0) {
                            alert('订单完成成功');
                            this.getOrderList()
                        } else {
                            alert(response.data.message);
                        }
                    })
                    //3.3失败时回调函数
                    .catch((err) => {
                        console.log(err);
                        alert(err);
                    });
            },
            toCreateOrder() {
                location.href='http://localhost/app-order/page/order/create'
            }
        },

    });

    window.onload = () => {
        vue.getOrderList();
    }


</script>


</body>

</html>